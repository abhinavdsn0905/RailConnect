<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Management - RailAdmin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0a0e1a; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        h1 { color: #00d4ff; margin-bottom: 20px; font-size: 28px; }
        .menu { margin-bottom: 30px; }
        .menu a { display: inline-block; padding: 10px 20px; background: #1a2235; color: #00d4ff; text-decoration: none; border-radius: 8px; margin-right: 10px; border: 1px solid #1e2d45; }
        .menu a:hover { background: #0d1b2e; }
        .toolbar { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-box { flex: 1; padding: 10px 16px; background: #111827; border: 1px solid #1e2d45; border-radius: 8px; color: #e2e8f0; }
        table { width: 100%; background: #111827; border-collapse: collapse; border-radius: 12px; overflow: hidden; }
        th, td { padding: 14px; text-align: left; border-bottom: 1px solid #1e2d45; }
        th { color: #00d4ff; font-weight: 600; background: #0d1b2e; }
        tr:hover { background: #1a2235; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-success { background: rgba(16,185,129,0.15); color: #10b981; }
        .badge-warning { background: rgba(245,158,11,0.15); color: #f59e0b; }
        .badge-danger { background: rgba(239,68,68,0.15); color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÇ Train Management</h1>
        
        <div class="menu">
            <a href="{% url 'adminpanel:dashboard' %}">‚Üê Back to Dashboard</a>
        </div>
        <button onclick="openTrainModal()" style="padding: 10px 20px; background: #10b981; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">+ Add Train</button>

<div id="trainModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000;">
    <div style="background:#111827; width:500px; margin:50px auto; padding:20px; border-radius:12px; border:1px solid #1e2d45; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <h2 style="color:#00d4ff; grid-column: span 2;">Add New Train</h2>
        <input type="text" id="tr_num" placeholder="Train Number" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="text" id="tr_name" placeholder="Train Name" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="text" id="tr_src" placeholder="Source" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="text" id="tr_dest" placeholder="Destination" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="time" id="tr_dep" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="time" id="tr_arr" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="number" id="tr_seats" placeholder="Total Seats" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <input type="number" id="tr_price" placeholder="Price" style="padding:10px; background:#0a0e1a; border:1px solid #1e2d45; color:white;">
        <button onclick="saveTrain()" style="grid-column: span 2; padding:12px; background:#00d4ff; color:#000; border:none; border-radius:8px; font-weight:bold;">Add Train</button>
        <button onclick="closeTrainModal()" style="grid-column: span 2; color:#ef4444; background:none; border:none;">Cancel</button>
    </div>
</div>

<script>
function openTrainModal() { document.getElementById('trainModal').style.display = 'block'; }
function closeTrainModal() { document.getElementById('trainModal').style.display = 'none'; }

async function saveTrain() {
    const data = {
        train_number: document.getElementById('tr_num').value,
        train_name: document.getElementById('tr_name').value,
        source: document.getElementById('tr_src').value,
        destination: document.getElementById('tr_dest').value,
        departure_time: document.getElementById('tr_dep').value,
        arrival_time: document.getElementById('tr_arr').value,
        total_seats: document.getElementById('tr_seats').value,
        price: document.getElementById('tr_price').value,
        status: 'on_time'
    };

    const response = await fetch("{% url 'adminpanel:train_create' %}", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
        body: JSON.stringify(data)
    });

    if (response.ok) { location.reload(); } 
    else { alert("Error adding train. Check if Train Number is unique."); }
}
</script>
        <div class="toolbar">
            <form method="get" style="flex: 1; display: flex; gap: 10px;">
                <input type="text" name="q" class="search-box" placeholder="Search trains..." value="{{ query }}">
                <select name="status" style="padding: 10px; background: #111827; border: 1px solid #1e2d45; border-radius: 8px; color: #e2e8f0;">
                    <option value="">All Status</option>
                    <option value="on_time" {% if status == 'on_time' %}selected{% endif %}>On Time</option>
                    <option value="delayed" {% if status == 'delayed' %}selected{% endif %}>Delayed</option>
                    <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
                <button type="submit" style="padding: 10px 20px; background: #00d4ff; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Filter</button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Train No.</th>
                    <th>Name</th>
                    <th>Route</th>
                    <th>Timing</th>
                    <th>Seats</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for train in trains %}
                <tr>
                    <td><strong>{{ train.train_number }}</strong></td>
                    <td>{{ train.train_name }}</td>
                    <td>{{ train.source }} ‚Üí {{ train.destination }}</td>
                    <td>{{ train.departure_time|time:"H:i" }} - {{ train.arrival_time|time:"H:i" }}</td>
                    <td>{{ train.available_seats }} / {{ train.total_seats }}</td>
                    <td>
                        <span class="badge {% if train.status == 'on_time' %}badge-success{% elif train.status == 'delayed' %}badge-warning{% else %}badge-danger{% endif %}">
                            {{ train.get_status_display }}
                        </span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; color: #64748b; padding: 40px;">No trains found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>