{% extends "adminpanel/admin_base.html" %}
{% block page_title %}Trains{% endblock %}
{% block n_trains %}active{% endblock %}
{% block topbar_title %}Train Management{% endblock %}
{% block topbar_badge %}<span class="topbar-pill">Operations</span>{% endblock %}

{% block content %}

<div class="ph">
    <div class="flex-between mb-18">
        <div>
            <div class="ph-title">ğŸš‚ Train Management</div>
            <div class="ph-sub">Add, edit, and manage all trains in the network</div>
        </div>
        <a href="{% url 'adminpanel:train_create' %}" class="btn btn-success">+ Add Train</a>
    </div>
</div>

<!-- IMPORTANT NOTE -->
<div class="alert alert-error" style="margin-bottom:18px; background:rgba(245,166,35,0.08); color:var(--c-amber); border-color:rgba(245,166,35,0.25);">
    âš  <strong>Important:</strong> After adding a train, you must click <strong>"Manage Routes"</strong> and add at least 2 stations before it will appear in ticket search results.
</div>

<!-- SEARCH -->
<form method="get" class="search-row">
    <input type="text" name="q" class="search-inp" placeholder="Search by train name or number..." value="{{ query }}">
    <button type="submit" class="search-btn">Search</button>
    {% if query %}<a href="{% url 'adminpanel:train_list' %}" class="btn btn-ghost">Clear</a>{% endif %}
</form>

<div class="t-wrap">
    <div class="t-header">
        <span class="t-header-title">All Trains</span>
        <span style="font-size:12px; color:var(--c-text-dim);">{{ trains|length }} train(s)</span>
    </div>
    <table>
        <thead>
            <tr>
                <th>Train No.</th>
                <th>Name</th>
                <th>Total Seats</th>
                <th>Available</th>
                <th>Price</th>
                <th>Routes</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for train in trains %}
            <tr>
                <td class="mono-cell">{{ train.train_number }}</td>
                <td>
                    <strong>{{ train.train_name }}</strong>
                    {% with route_count=train.routes.count %}
                    {% if route_count < 2 %}
                        <span class="badge badge-amber" style="margin-left:6px;" title="Add at least 2 route stops so this train appears in search">âš  No Routes</span>
                    {% endif %}
                    {% endwith %}
                </td>
                <td>{{ train.total_seats }}</td>
                <td>
                    {% if train.available_seats > 0 %}
                        <span class="badge badge-green">{{ train.available_seats }}</span>
                    {% else %}
                        <span class="badge badge-red">Sold Out</span>
                    {% endif %}
                </td>
                <td><span class="badge badge-amber">â‚¹{{ train.price }}</span></td>
                <td>
                    <a href="{% url 'adminpanel:manage_routes' train.id %}" class="btn btn-ghost btn-sm">
                        ğŸ—º Manage Routes
                        {% with rc=train.routes.count %}
                        {% if rc > 0 %}({{ rc }}){% endif %}
                        {% endwith %}
                    </a>
                </td>
                <td>
                    <div class="flex-row">
                        <a href="{% url 'adminpanel:train_edit' train.id %}" class="btn btn-primary btn-sm">âœ Edit</a>
                        <a href="{% url 'adminpanel:train_delete' train.id %}"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Delete {{ train.train_name }}? This cannot be undone.')">
                            ğŸ—‘ Delete
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">
                    <div class="empty">
                        <div class="empty-icon">ğŸš‚</div>
                        <p>No trains found. <a href="{% url 'adminpanel:train_create' %}" style="color:var(--c-blue);">Add your first train â†’</a></p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}